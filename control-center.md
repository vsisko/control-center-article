Введение

## Обзор функционала

Представим, что Вам нужно настроить мониторинг распределённой базы данных, такой как GridGain. Метрики положим в Prometheus. Графики нарисуем в Grafana. Про систему оповещения не забудем – для этого настроим Zabbix. Для анализа трейсов воспользуемся Jaeger. 

Для управления состоянием и CLI хорош. А для SQL запросов воспользуемся бесплатным JDBC клиентом вроде DBeaver.

Теперь настраиваем для каждого из инструментов систему аутентификации, чтобы никакая информация не просочилась, и мы у цели. В итоге получили связку инструментов, которая сложнее самой распределённой системы, ради которой всё затевалось.

Действительно есть компании, готовые идти по данному пути, но как правило, для настройки и поддержки подобной системы требуется целая команда специалистов и большое количество ресурсов.

### Какие ещё есть варианты?

Задачу можно сильно облегчить, не теряя при этом в возможностях. В арсенале GridGain имеется инструмент под названием Control Center, который покрывает значительную часть задач по отслеживанию состояния кластера, траблшутингу, базовому менеджменту, снятию бэкапов и прочему. Control Center предоставляет единый интерфейс, интегрированный и разработанный специально для GridGain, и максимально учитывающий его особенности. Control Center умеет работать с GridGain версии начиная с 8.7.23 любой редакции, а также с Apache Ignite версии не младше 2.8.1.

Давайте взглянем подробнее на то, для чего Control Center хорош.

### Настройка

Перед командой разработки Control Center стояла задача сделать настройку кластера для мониторинга максимально простой. Для старта Вам нужно будет скопировать модуль `control-center-agent` из директории `libs/optional` в `libs` в дистрибутиве GridGain. После старта узла в логах можно будет найти ссылку, пройдя по которой Вы попадёте на экран мониторинга на сайте [control.gridgain.com](control.gridgain.com). На этом настройка завершена.

Также Control Center можно запустить в собственном окружении и настроить кластер для мониторинга через него при помощи команды `bin/management.sh --uri <URI>`.

Для Apache Ignite первый шаг процедуры несколько отличается, так как агент не поставляется в дистрибутиве, но его можно скачать на сайте GridGain: https://www.gridgain.com/resources/download#controlcenter.

Процесс настройки подробно описан в документации: https://www.gridgain.com/docs/control-center/latest/connect-gridgain-cluster

### Отображение метрик

Основой любой системы мониторинга является возможность работы с метриками. В Control Center данной функциональности уделено особое внимание. Экран Dashboard предлагает возможность настройки "виджетов" на основе метрик, поступающих из кластера. Среди доступных способов визуализации на данный момент есть график, гистограмма, таблица и тепловая карта (heat map). Также есть виджеты специального вида как список узлов и визуализация ребаланса.

Dashboard может содержать набор данных виджетов в любом удобном расположении друг относительно друга. Dashboard-ов может быть несколько, что позволяет создавать специализированные экраны мониторинга определённых подсистем GridGain. Например, экран мониторинга состояния диска может выглядеть следующим образом:

<Скриншот>

### Настройка уведомлений

Метрики могут служить не только для визуального отображения информации. На основе них также можно настроить уведомления, которые будут срабатывать при удовлетворении указанных условий. Если Вы беспокоитесь за то, что память на одном из Ваших серверов переполнится, данное беспокойство можно облегчить, настроив уведомление по SMS или Email. Если соответсвующая метрика пересечёт указанный предел, и продержится на таком уровне достаточное время, то Вам придёт об этом сообщение.

### Трейсинг

Многие операции в кластере требуют взаимодействия между разными узлами. В случае неполадок или задержек бывает сложно определить, какой узел является виновником, и на какой стадии возникла проблема.
Трейсинг – одно из нововведений в GridGain и Apache Ignite, упрощающих анализ таких ситуаций. Это фреймворк, позволяющий отслеживать исполнение операций, даже если они имеют распределённый характер. Каждый этап исполнения (span) логируется и привязывается к операции, для которой данное отслеживание (trace) было запущено. Все транзакции в кластере могут быть отслежены, и для самых долгих из них есть возможность найти этап, занявший наибольшее время. Хоть трейсинг и появился в GridGain совсем недавно, его поддержка уже реализована в Control Center.

<Скриншот с трейсами Discovery> Самая важная информация, относящаяся к трейсам, находится на видном месте, чтобы не было необходимости долго её искать.

<Скриншот с деталями спана> Поднобные детали для каждого спана также доступны.

### Запуск SQL

У GridGain есть возможность работы с данными при помощи SQL. Для выполнения задач, связанных с SQL запросами, в Control Center есть отдельная секция. Там вы найдёте редактор кода с базовыми возможностями подсветки синтаксиса и автоподстановкой. Можно иметь несколько вкладок с запросами, которые сохраняются между запусками.

<Скриншот с запросом>

Запросы, выполняющиеся в текущий момент, можно найти на отдельной вкладке.

<Скриншот Running Queries>

Также здесь можно найти статискику по запросом с информацией о числе запусков, падений и времени исполнения.

<Скриншот со статистикой>

### Создание снимков данных

GridGain Ultimate Edition предлагает функционал снятия снимков данных, позволяющий зафиксировать набор записей, присутствующий в кластере на момент начала создания снимка. При этом остановка работы кластера не требуется. Для работы со снимками в Control Center есть отдельная секция, где Вы можете создать новый снимок, а также применить, проверить или переместить существующий. Поддерживается работа с полными и инкрементальными снимками, со сжатием и без.

<Скриншот с пачкой снапшотов>

### Управление кластерами

Такие административные действия как активация и деактивация, изменение набора узлов в базовой топологии, настройка новых кластеров для мониторинга, собраны на отдельном экране Control Center. Здесь Вы можете посмотреть на список своих кластеров, или выполнить действия по настройке, для которых обычно требуется CLI. Это весьма полезный экран для администраторов, производящих работу над кластером, требующую ввода или вывода узлов из топологии.

<Скриншот экрана BLT & Clusters>

## Архитектура

### Агент

### Метрики
В Apache Ignite и GridGain находится в активной стадии проект по разработке фреймворка, позволяющего упростить работу с метриками. Все метрики в системе регистрируются в единый реестр, из которого их можно экспортировать в удобном для конкретной цели формате. О подробностях можно узнать [в соответствующем IEP](https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=112820392).

Интересным для Control Center является возможность реализации exporter-а метрик, который может быть использован для пересылки метрик из GridGain в стороннюю систему мониторинга. Control Center активно пользуется данным фреймворком и имеет свой exporter.

## Разбор кейсов
## Чего не хватает?
## Ссылки и дополнительные материалы